<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">

		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	</head>
	<body>
		<div class="container-fluid">
			<div class="row">
				<table class="table table-striped table-hover table-sm">
					<thead>
						<tr>
							<th>#</th>
							<th>Mac Address</th>
							<th>Giroscopio eje X</th>
							<th>Giroscopio eje Y</th>
							<th>Giroscopio eje Z</th>
							<th>Aceleración eje X</th>
							<th>Aceleración eje Y</th>
							<th>Aceleración eje Z</th>
							<th>En movimiento</th>
							<th>Estado Batería</th>
						</tr>
					</thead>

					<tbody></tbody>
				</table>
			</div>
		</div>
	</body>

	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	
	<script type="text/javascript">

		var socket = io.connect();

		socket.on('accelData', function(accelData) {
			var macAddress = accelData.data.macAddress.split(':').join('_')
			
			var deviceRow = $('tr#' + macAddress)

			if (deviceRow.length === 1) {
				updateRow(deviceRow, accelData.data);
			} else {
				newRow(macAddress)
				updateRow($('tr#' + macAddress), accelData.data)
			}
		});

		function updateRow(deviceRow, data) {
			deviceRow.children(".gyroX").text(data.gyro.x);
			deviceRow.children(".gyroY").text(data.gyro.y);
			deviceRow.children(".gyroZ").text(data.gyro.z);
			deviceRow.children(".accelX").text(data.accel.x);
			deviceRow.children(".accelY").text(data.accel.y);
			deviceRow.children(".accelZ").text(data.accel.z);
			deviceRow.children(".battery").text(data.battery + '%');
		}

		function newRow(macAddress) {
			var newRow = '<tr id=' + macAddress + '>'
					+ '<td>1</td>'
					+ '<td>' + macAddress.split('_').join(':') + '</td>'
					+ '<td class=\"gyroX\"></td>'
					+ '<td class=\"gyroY\"></td>'
					+ '<td class=\"gyroZ\"></td>'
					+ '<td class=\"accel\X"></td>'
					+ '<td class=\"accel\Y"></td>'
					+ '<td class=\"accel\Z"></td>'
					+ '<td class=\"in-movement\">x</td>'
					+ '<td class=\"battery\">83%</td>'
				+ '</tr\>';

			$('tbody').append(newRow);
		}

	</script>
</html>